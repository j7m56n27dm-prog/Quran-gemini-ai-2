<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qur'onIQ Premium - Qur'on Hifzi Platformasi</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Amiri:wght@400;700&family=Noto+Naskh+Arabic:wght@400;600;700&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #1a6b3d;
            --primary-light: #28a05c;
            --primary-dark: #0e4527;
            --accent: #c9a055;
            --accent-light: #e0c080;
            --accent-dark: #8a6d3b;
            --success: #10b981;
            --error: #ef4444;
            --bg: #f7f5f2;
            --bg-alt: #eceae6;
            --surface: #ffffff;
            --text: #1a1a1a;
            --text-secondary: #5a5a5a;
            --text-muted: #909090;
            --border: #d8d4ce;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
            --glow: 0 0 40px rgba(26,107,61,0.2);
            --radius: 18px;
            --radius-sm: 12px;
            --font: 'Poppins', sans-serif;
            --font-ar: 'Noto Naskh Arabic', 'Amiri', serif;
            --font-quran: 'Amiri Quran', 'Amiri', serif;
        }
        [data-theme="dark"] {
            --bg: #0d1117;
            --bg-alt: #161b22;
            --surface: #21262d;
            --text: #f0f0f0;
            --text-secondary: #a0a0a0;
            --text-muted: #707070;
            --border: #30363d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        .bg-effects {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }
        .bg-effects::before {
            content: '';
            position: absolute;
            top: -30%;
            right: -20%;
            width: 80%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(26,107,61,0.1) 0%, transparent 70%);
            animation: float1 20s ease-in-out infinite;
        }
        .bg-effects::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -20%;
            width: 80%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(201,160,85,0.08) 0%, transparent 70%);
            animation: float2 25s ease-in-out infinite;
        }
        @keyframes float1 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-30px, 30px) rotate(5deg); }
        }
        @keyframes float2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(30px, -30px) rotate(-5deg); }
        }
        .app {
            max-width: 500px;
            margin: 0 auto;
            padding: 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0 24px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }
        .logo-icon {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow), var(--glow);
        }
        .logo-text {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header-btns {
            display: flex;
            gap: 8px;
        }
        .lang-select, .theme-btn {
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        .lang-select:hover, .theme-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        .theme-btn {
            width: 42px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .page {
            display: none;
            flex: 1;
            animation: fadeIn 0.5s ease;
        }
        .page.active { display: flex; flex-direction: column; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 28px 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientMove 3s linear infinite;
        }
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        .hero {
            text-align: center;
            padding: 16px 0;
        }
        .hero-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, rgba(26,107,61,0.15), rgba(201,160,85,0.15));
            border: 3px solid var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
            animation: heroFloat 3s ease-in-out infinite;
        }
        @keyframes heroFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }
        .hero-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
        }
        .hero-desc {
            color: var(--text-secondary);
            font-size: 0.92rem;
            line-height: 1.6;
            max-width: 300px;
            margin: 0 auto;
        }
        .score-box {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-sm);
            padding: 24px;
            margin: 24px 0;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .score-box::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .score-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        .score-value {
            font-size: 3rem;
            font-weight: 900;
        }
        .btn {
            width: 100%;
            padding: 16px 20px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 8px 25px rgba(26,107,61,0.3);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(26,107,61,0.4);
        }
        .btn-gold {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 8px 25px rgba(201,160,85,0.3);
        }
        .btn-gold:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(201,160,85,0.4);
        }
        .btn-outline {
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
        }
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }
        .btn-ghost:hover {
            background: var(--bg-alt);
            color: var(--primary);
        }
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .section-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .setting-group { margin-bottom: 24px; }
        .setting-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .setting-label::before {
            content: '';
            width: 4px;
            height: 16px;
            background: linear-gradient(180deg, var(--primary), var(--accent));
            border-radius: 2px;
        }
        .pills {
            display: flex;
            gap: 8px;
        }
        .pill {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text);
            font-weight: 600;
            font-size: 0.88rem;
            font-family: var(--font);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .pill:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }
        .pill.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }
        .type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .type-card {
            padding: 18px 14px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .type-card:hover {
            border-color: var(--primary-light);
            transform: translateY(-4px);
        }
        .type-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(26,107,61,0.08), rgba(201,160,85,0.04));
        }
        .type-icon { font-size: 2rem; margin-bottom: 10px; }
        .type-name { font-weight: 700; font-size: 0.9rem; color: var(--text); margin-bottom: 4px; }
        .type-desc { font-size: 0.75rem; color: var(--text-muted); }
        .para-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-height: 220px;
            overflow-y: auto;
            padding: 4px;
        }
        .para-item {
            aspect-ratio: 1;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--surface);
            color: var(--text);
            font-weight: 700;
            font-size: 0.9rem;
            font-family: var(--font);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .para-item:hover {
            border-color: var(--primary);
            transform: scale(1.1);
        }
        .para-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }
        .qari-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .qari-card {
            padding: 16px 10px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .qari-card:hover {
            border-color: var(--primary-light);
            transform: translateY(-3px);
        }
        .qari-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(26,107,61,0.08), rgba(201,160,85,0.04));
        }
        .qari-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--bg-alt);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: all 0.3s;
        }
        .qari-card.active .qari-avatar {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            transform: scale(1.1);
        }
        .qari-name { font-weight: 600; font-size: 0.8rem; color: var(--text); }
        .divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 18px 0;
            color: var(--text-muted);
            font-size: 0.82rem;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .quiz-count { font-size: 0.9rem; font-weight: 700; color: var(--text-secondary); }
        .quiz-badge {
            font-size: 0.68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 14px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 20px;
        }
        .progress-bar {
            height: 8px;
            background: var(--bg-alt);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 8px;
            transition: width 0.5s;
        }
        .question-text {
            text-align: center;
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 16px;
            line-height: 1.6;
        }
        .ayah-display {
            margin: 20px 0;
            padding: 24px 18px;
            background: linear-gradient(135deg, rgba(26,107,61,0.06), rgba(201,160,85,0.04));
            border-radius: var(--radius);
            border: 2px solid rgba(26,107,61,0.1);
        }
        .ayah-arabic {
            font-family: var(--font-quran);
            font-size: 1.9rem;
            line-height: 2.4;
            text-align: center;
            color: var(--text);
            direction: rtl;
        }
        .ayah-info {
            text-align: center;
            margin-top: 12px;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 600;
        }
        .audio-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
            padding: 28px;
            margin: 20px 0;
            background: var(--bg-alt);
            border-radius: var(--radius);
            border: 2px solid var(--border);
        }
        .play-button {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 10px 35px rgba(26,107,61,0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .play-button:hover { transform: scale(1.08); }
        .play-button:active { transform: scale(0.95); }
        .play-button.playing { animation: pulse 1s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .audio-text { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-item {
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .option-item:hover:not(.disabled) {
            border-color: var(--primary-light);
            transform: translateX(6px);
        }
        .option-letter {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-alt);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        .option-content {
            flex: 1;
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--text);
        }
        .option-item.arabic .option-content {
            font-family: var(--font-ar);
            font-size: 1.3rem;
            text-align: right;
            direction: rtl;
            line-height: 1.8;
        }
        .option-item.correct {
            background: rgba(16,185,129,0.12);
            border-color: var(--success);
        }
        .option-item.correct .option-letter {
            background: var(--success);
            color: white;
        }
        .option-item.wrong {
            background: rgba(239,68,68,0.12);
            border-color: var(--error);
            animation: shake 0.4s;
        }
        .option-item.wrong .option-letter {
            background: var(--error);
            color: white;
        }
        .option-item.disabled { pointer-events: none; opacity: 0.6; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .wisdom-box {
            margin-top: 20px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(201,160,85,0.12), rgba(201,160,85,0.06));
            border-radius: var(--radius-sm);
            border: 2px solid rgba(201,160,85,0.2);
            display: none;
        }
        .wisdom-box.show { display: block; animation: slideUp 0.5s; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wisdom-title {
            font-weight: 700;
            font-size: 0.82rem;
            color: var(--accent-dark);
            margin-bottom: 8px;
        }
        .wisdom-text { font-size: 0.9rem; line-height: 1.7; color: var(--text-secondary); }
        .wisdom-source { margin-top: 8px; font-size: 0.75rem; color: var(--text-muted); font-style: italic; }
        .quiz-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .quiz-footer .btn { flex: 1; }
        .btn-next { display: none; }
        .btn-next.show { display: flex; animation: fadeIn 0.4s; }
        .result-section { text-align: center; padding: 16px 0; }
        .result-ring {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: resultIn 0.8s ease-out;
        }
        @keyframes resultIn {
            from { transform: scale(0) rotate(-180deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }
        .result-ring.excellent {
            background: rgba(16,185,129,0.12);
            border: 4px solid var(--success);
            color: var(--success);
        }
        .result-ring.good {
            background: rgba(201,160,85,0.12);
            border: 4px solid var(--accent);
            color: var(--accent);
        }
        .result-ring.poor {
            background: rgba(239,68,68,0.12);
            border: 4px solid var(--error);
            color: var(--error);
        }
        .result-percent { font-size: 2.8rem; font-weight: 900; }
        .result-heading { font-size: 1.4rem; font-weight: 800; color: var(--text); margin-bottom: 20px; }
        .stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-box {
            padding: 16px;
            border-radius: var(--radius-sm);
            text-align: center;
            border: 2px solid var(--border);
        }
        .stat-box.success { background: rgba(16,185,129,0.1); border-color: var(--success); }
        .stat-box.error { background: rgba(239,68,68,0.1); border-color: var(--error); }
        .stat-num { font-size: 1.8rem; font-weight: 800; }
        .stat-box.success .stat-num { color: var(--success); }
        .stat-box.error .stat-num { color: var(--error); }
        .stat-text { font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); margin-top: 4px; }
        .result-message {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-alt);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--primary);
        }
        .advice-list { list-style: none; }
        .advice-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }
        .advice-item:last-child { border-bottom: none; }
        .advice-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, rgba(26,107,61,0.1), rgba(201,160,85,0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        .advice-content { flex: 1; }
        .advice-title { font-weight: 700; font-size: 0.95rem; color: var(--text); margin-bottom: 4px; }
        .advice-desc { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6; }
        .footer {
            margin-top: auto;
            padding: 20px 0;
            text-align: center;
        }
        .footer-text {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .footer-text b { color: var(--primary); }
        .loader {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
            z-index: 1000;
        }
        [data-theme="dark"] .loader { background: rgba(13,17,23,0.95); }
        .loader.show { display: flex; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-text { font-weight: 600; color: var(--text-secondary); }
        .hidden { display: none !important; }
        .mt-12 { margin-top: 12px; }
        .mt-16 { margin-top: 16px; }
        @media (max-width: 400px) {
            .hero-title { font-size: 1.5rem; }
            .ayah-arabic { font-size: 1.6rem; }
            .option-item.arabic .option-content { font-size: 1.15rem; }
            .para-grid { grid-template-columns: repeat(5, 1fr); }
        }
    </style>
</head>
<body data-theme="light">
    <div class="bg-effects"></div>
    
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <div class="loader-text" id="loaderText">Yuklanmoqda...</div>
    </div>

    <div class="app">
        <header class="header">
            <div class="logo" onclick="App.goTo('home')">
                <div class="logo-icon">ğŸ“–</div>
                <div class="logo-text">Qur'onIQ</div>
            </div>
            <div class="header-btns">
                <select class="lang-select" id="langSelect" onchange="App.changeLang(this.value)">
                    <option value="uz">O'zbek</option>
                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="en">English</option>
                </select>
                <button class="theme-btn" id="themeBtn" onclick="App.toggleTheme()">ğŸŒ™</button>
            </div>
        </header>

        <!-- HOME -->
        <main id="pageHome" class="page active">
            <div class="card">
                <div class="hero">
                    <div class="hero-icon">ğŸ“–</div>
                    <h1 class="hero-title" data-t="heroTitle">Xush kelibsiz!</h1>
                    <p class="hero-desc" data-t="heroDesc">Qur'on hifzini mustahkamlang va bilimingizni sinang</p>
                    <div class="score-box">
                        <div class="score-label" data-t="highScore">Eng yuqori natija</div>
                        <div class="score-value" id="bestScore">0%</div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="App.goTo('textSetup')">
                        <span>ğŸ“</span>
                        <span data-t="btnTextTest">Matnli test</span>
                    </button>
                    <button class="btn btn-gold" onclick="App.goTo('audioSetup')">
                        <span>ğŸ§</span>
                        <span data-t="btnAudioTest">Audio test</span>
                    </button>
                    <button class="btn btn-outline" onclick="App.goTo('tips')">
                        <span>ğŸ’¡</span>
                        <span data-t="btnTips">Maslahatlar</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- TEXT SETUP -->
        <section id="pageTextSetup" class="page">
            <div class="card">
                <h2 class="section-title"><span>ğŸ“</span> <span data-t="textTestTitle">Matnli test</span></h2>
                
                <div class="setting-group">
                    <div class="setting-label" data-t="testType">Test turi</div>
                    <div class="type-grid">
                        <div class="type-card active" data-ttype="continue" onclick="App.setTestType('continue')">
                            <div class="type-icon">â¡ï¸</div>
                            <div class="type-name" data-t="typeContinue">Davomini toping</div>
                            <div class="type-desc" data-t="typeContinueDesc">Keyingi oyat</div>
                        </div>
                        <div class="type-card" data-ttype="surah" onclick="App.setTestType('surah')">
                            <div class="type-icon">ğŸ”</div>
                            <div class="type-name" data-t="typeSurah">Surani toping</div>
                            <div class="type-desc" data-t="typeSurahDesc">Qaysi sura?</div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label" data-t="difficulty">Qiyinchilik</div>
                    <div class="pills">
                        <button class="pill" data-diff="easy" onclick="App.setDiff('easy')" data-t="easy">Oson</button>
                        <button class="pill active" data-diff="medium" onclick="App.setDiff('medium')" data-t="medium">O'rta</button>
                        <button class="pill" data-diff="hard" onclick="App.setDiff('hard')" data-t="hard">Qiyin</button>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label" data-t="selectPara">Para tanlang</div>
                    <button class="btn btn-primary" onclick="App.beginTest('text')">
                        <span>ğŸ“š</span>
                        <span data-t="allSurahs">Barcha suralardan</span>
                    </button>
                    <div class="divider" data-t="orSelectPara">yoki para tanlang</div>
                    <div class="para-grid" id="paraGrid"></div>
                </div>

                <button class="btn btn-ghost mt-12" onclick="App.goTo('home')">
                    <span>â†</span>
                    <span data-t="back">Ortga</span>
                </button>
            </div>
        </section>

        <!-- AUDIO SETUP -->
        <section id="pageAudioSetup" class="page">
            <div class="card">
                <h2 class="section-title"><span>ğŸ§</span> <span data-t="audioTestTitle">Audio test</span></h2>

                <div class="setting-group">
                    <div class="setting-label" data-t="selectQari">Qori tanlang</div>
                    <div class="qari-grid" id="qariGrid"></div>
                </div>

                <div class="setting-group">
                    <div class="setting-label" data-t="testType">Test turi</div>
                    <div class="type-grid">
                        <div class="type-card active" data-atype="surah" onclick="App.setAudioType('surah')">
                            <div class="type-icon">ğŸ”</div>
                            <div class="type-name" data-t="audioSurah">Surani toping</div>
                            <div class="type-desc" data-t="audioSurahDesc">Eshiting va toping</div>
                        </div>
                        <div class="type-card" data-atype="continue" onclick="App.setAudioType('continue')">
                            <div class="type-icon">â¡ï¸</div>
                            <div class="type-name" data-t="audioContinue">Davomi</div>
                            <div class="type-desc" data-t="audioContinueDesc">Keyingisi nima?</div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-gold mt-16" onclick="App.beginTest('audio')">
                    <span>ğŸµ</span>
                    <span data-t="startTest">Testni boshlash</span>
                </button>

                <button class="btn btn-ghost mt-12" onclick="App.goTo('home')">
                    <span>â†</span>
                    <span data-t="back">Ortga</span>
                </button>
            </div>
        </section>

        <!-- QUIZ -->
        <section id="pageQuiz" class="page">
            <div class="card">
                <div class="quiz-header">
                    <span class="quiz-count" id="quizCount">1 / 10</span>
                    <span class="quiz-badge" id="quizBadge">TEST</span>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>

                <p class="question-text" id="questionText">Savol yuklanmoqda...</p>

                <div class="ayah-display hidden" id="ayahDisplay">
                    <div class="ayah-arabic" id="ayahArabic"></div>
                    <div class="ayah-info" id="ayahInfo"></div>
                </div>

                <div class="audio-player hidden" id="audioPlayer">
                    <button class="play-button" id="playButton" onclick="App.togglePlay()">â–¶ï¸</button>
                    <span class="audio-text" id="audioText">Tinglash uchun bosing</span>
                </div>

                <div class="options-list" id="optionsList"></div>

                <div class="wisdom-box" id="wisdomBox">
                    <div class="wisdom-title">âœ¨ <span data-t="wisdom">Hikmat</span></div>
                    <p class="wisdom-text" id="wisdomText"></p>
                    <p class="wisdom-source" id="wisdomSource"></p>
                </div>

                <div class="quiz-footer">
                    <button class="btn btn-outline" onclick="App.quitQuiz()" style="flex:0.4">
                        <span data-t="exit">Chiqish</span>
                    </button>
                    <button class="btn btn-primary btn-next" id="nextBtn" onclick="App.nextQ()">
                        <span data-t="next">Keyingi</span>
                        <span>â†’</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- RESULT -->
        <section id="pageResult" class="page">
            <div class="card">
                <div class="result-section">
                    <div class="result-ring" id="resultRing">
                        <span class="result-percent" id="resultPercent">0%</span>
                    </div>
                    <h2 class="result-heading" data-t="resultTitle">Natija</h2>
                    <div class="stats-row">
                        <div class="stat-box success">
                            <div class="stat-num" id="correctCount">0</div>
                            <div class="stat-text" data-t="correct">To'g'ri</div>
                        </div>
                        <div class="stat-box error">
                            <div class="stat-num" id="wrongCount">0</div>
                            <div class="stat-text" data-t="wrong">Xato</div>
                        </div>
                    </div>
                    <p class="result-message" id="resultMessage"></p>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="App.retryTest()">
                            <span>ğŸ”„</span>
                            <span data-t="retry">Qayta urinish</span>
                        </button>
                        <button class="btn btn-outline" onclick="App.goTo('home')">
                            <span>ğŸ </span>
                            <span data-t="home">Bosh sahifa</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- TIPS -->
        <section id="pageTips" class="page">
            <div class="card">
                <h2 class="section-title"><span>ğŸ’¡</span> <span data-t="tipsTitle">Maslahatlar</span></h2>
                <ul class="advice-list" id="adviceList"></ul>
                <button class="btn btn-ghost mt-16" onclick="App.goTo('home')">
                    <span>â†</span>
                    <span data-t="back">Ortga</span>
                </button>
            </div>
        </section>

        <footer class="footer">
            <p class="footer-text">Â©ï¸ <b>Muhammad Daler Qori</b> tomonidan yasalgan</p>
        </footer>
    </div>

<script>
// ========== FULL QURAN DATA - 114 SURAHS ==========
const SURAHS = [
    {n:1,name:"Al-Fatiha",ar:"Ø§Ù„ÙØ§ØªØ­Ø©",a:7,s:1},
    {n:2,name:"Al-Baqarah",ar:"Ø§Ù„Ø¨Ù‚Ø±Ø©",a:286,s:8},
    {n:3,name:"Ali 'Imran",ar:"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†",a:200,s:294},
    {n:4,name:"An-Nisa",ar:"Ø§Ù„Ù†Ø³Ø§Ø¡",a:176,s:494},
    {n:5,name:"Al-Ma'idah",ar:"Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©",a:120,s:670},
    {n:6,name:"Al-An'am",ar:"Ø§Ù„Ø£Ù†Ø¹Ø§Ù…",a:165,s:790},
    {n:7,name:"Al-A'raf",ar:"Ø§Ù„Ø£Ø¹Ø±Ø§Ù",a:206,s:955},
    {n:8,name:"Al-Anfal",ar:"Ø§Ù„Ø£Ù†ÙØ§Ù„",a:75,s:1161},
    {n:9,name:"At-Tawbah",ar:"Ø§Ù„ØªÙˆØ¨Ø©",a:129,s:1236},
    {n:10,name:"Yunus",ar:"ÙŠÙˆÙ†Ø³",a:109,s:1365},
    {n:11,name:"Hud",ar:"Ù‡ÙˆØ¯",a:123,s:1474},
    {n:12,name:"Yusuf",ar:"ÙŠÙˆØ³Ù",a:111,s:1597},
    {n:13,name:"Ar-Ra'd",ar:"Ø§Ù„Ø±Ø¹Ø¯",a:43,s:1708},
    {n:14,name:"Ibrahim",ar:"Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…",a:52,s:1751},
    {n:15,name:"Al-Hijr",ar:"Ø§Ù„Ø­Ø¬Ø±",a:99,s:1803},
    {n:16,name:"An-Nahl",ar:"Ø§Ù„Ù†Ø­Ù„",a:128,s:1902},
    {n:17,name:"Al-Isra",ar:"Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡",a:111,s:2030},
    {n:18,name:"Al-Kahf",ar:"Ø§Ù„ÙƒÙ‡Ù",a:110,s:2141},
    {n:19,name:"Maryam",ar:"Ù…Ø±ÙŠÙ…",a:98,s:2251},
    {n:20,name:"Taha",ar:"Ø·Ù‡",a:135,s:2349},
    {n:21,name:"Al-Anbya",ar:"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡",a:112,s:2484},
    {n:22,name:"Al-Hajj",ar:"Ø§Ù„Ø­Ø¬",a:78,s:2596},
    {n:23,name:"Al-Mu'minun",ar:"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†",a:118,s:2674},
    {n:24,name:"An-Nur",ar:"Ø§Ù„Ù†ÙˆØ±",a:64,s:2792},
    {n:25,name:"Al-Furqan",ar:"Ø§Ù„ÙØ±Ù‚Ø§Ù†",a:77,s:2856},
    {n:26,name:"Ash-Shu'ara",ar:"Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡",a:227,s:2933},
    {n:27,name:"An-Naml",ar:"Ø§Ù„Ù†Ù…Ù„",a:93,s:3160},
    {n:28,name:"Al-Qasas",ar:"Ø§Ù„Ù‚ØµØµ",a:88,s:3253},
    {n:29,name:"Al-Ankabut",ar:"Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª",a:69,s:3341},
    {n:30,name:"Ar-Rum",ar:"Ø§Ù„Ø±ÙˆÙ…",a:60,s:3410},
    {n:31,name:"Luqman",ar:"Ù„Ù‚Ù…Ø§Ù†",a:34,s:3470},
    {n:32,name:"As-Sajdah",ar:"Ø§Ù„Ø³Ø¬Ø¯Ø©",a:30,s:3504},
    {n:33,name:"Al-Ahzab",ar:"Ø§Ù„Ø£Ø­Ø²Ø§Ø¨",a:73,s:3534},
    {n:34,name:"Saba",ar:"Ø³Ø¨Ø£",a:54,s:3607},
    {n:35,name:"Fatir",ar:"ÙØ§Ø·Ø±",a:45,s:3661},
    {n:36,name:"Ya-Sin",ar:"ÙŠØ³",a:83,s:3706},
    {n:37,name:"As-Saffat",ar:"Ø§Ù„ØµØ§ÙØ§Øª",a:182,s:3789},
    {n:38,name:"Sad",ar:"Øµ",a:88,s:3971},
    {n:39,name:"Az-Zumar",ar:"Ø§Ù„Ø²Ù…Ø±",a:75,s:4059},
    {n:40,name:"Ghafir",ar:"ØºØ§ÙØ±",a:85,s:4134},
    {n:41,name:"Fussilat",ar:"ÙØµÙ„Øª",a:54,s:4219},
    {n:42,name:"Ash-Shuraa",ar:"Ø§Ù„Ø´ÙˆØ±Ù‰",a:53,s:4273},
    {n:43,name:"Az-Zukhruf",ar:"Ø§Ù„Ø²Ø®Ø±Ù",a:89,s:4326},
    {n:44,name:"Ad-Dukhan",ar:"Ø§Ù„Ø¯Ø®Ø§Ù†",a:59,s:4415},
    {n:45,name:"Al-Jathiyah",ar:"Ø§Ù„Ø¬Ø§Ø«ÙŠØ©",a:37,s:4474},
    {n:46,name:"Al-Ahqaf",ar:"Ø§Ù„Ø£Ø­Ù‚Ø§Ù",a:35,s:4511},
    {n:47,name:"Muhammad",ar:"Ù…Ø­Ù…Ø¯",a:38,s:4546},
    {n:48,name:"Al-Fath",ar:"Ø§Ù„ÙØªØ­",a:29,s:4584},
    {n:49,name:"Al-Hujurat",ar:"Ø§Ù„Ø­Ø¬Ø±Ø§Øª",a:18,s:4613},
    {n:50,name:"Qaf",ar:"Ù‚",a:45,s:4631},
    {n:51,name:"Adh-Dhariyat",ar:"Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª",a:60,s:4676},
    {n:52,name:"At-Tur",ar:"Ø§Ù„Ø·ÙˆØ±",a:49,s:4736},
    {n:53,name:"An-Najm",ar:"Ø§Ù„Ù†Ø¬Ù…",a:62,s:4785},
    {n:54,name:"Al-Qamar",ar:"Ø§Ù„Ù‚Ù…Ø±",a:55,s:4847},
    {n:55,name:"Ar-Rahman",ar:"Ø§Ù„Ø±Ø­Ù…Ù†",a:78,s:4902},
    {n:56,name:"Al-Waqi'ah",ar:"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©",a:96,s:4980},
    {n:57,name:"Al-Hadid",ar:"Ø§Ù„Ø­Ø¯ÙŠØ¯",a:29,s:5076},
    {n:58,name:"Al-Mujadila",ar:"Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©",a:22,s:5105},
    {n:59,name:"Al-Hashr",ar:"Ø§Ù„Ø­Ø´Ø±",a:24,s:5127},
    {n:60,name:"Al-Mumtahanah",ar:"Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©",a:13,s:5151},
    {n:61,name:"As-Saf",ar:"Ø§Ù„ØµÙ",a:14,s:5164},
    {n:62,name:"Al-Jumu'ah",ar:"Ø§Ù„Ø¬Ù…Ø¹Ø©",a:11,s:5178},
    {n:63,name:"Al-Munafiqun",ar:"Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†",a:11,s:5189},
    {n:64,name:"At-Taghabun",ar:"Ø§Ù„ØªØºØ§Ø¨Ù†",a:18,s:5200},
    {n:65,name:"At-Talaq",ar:"Ø§Ù„Ø·Ù„Ø§Ù‚",a:12,s:5218},
    {n:66,name:"At-Tahrim",ar:"Ø§Ù„ØªØ­Ø±ÙŠÙ…",a:12,s:5230},
    {n:67,name:"Al-Mulk",ar:"Ø§Ù„Ù…Ù„Ùƒ",a:30,s:5242},
    {n:68,name:"Al-Qalam",ar:"Ø§Ù„Ù‚Ù„Ù…",a:52,s:5272},
    {n:69,name:"Al-Haqqah",ar:"Ø§Ù„Ø­Ø§Ù‚Ø©",a:52,s:5324},
    {n:70,name:"Al-Ma'arij",ar:"Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬",a:44,s:5376},
    {n:71,name:"Nuh",ar:"Ù†ÙˆØ­",a:28,s:5420},
    {n:72,name:"Al-Jinn",ar:"Ø§Ù„Ø¬Ù†",a:28,s:5448},
    {n:73,name:"Al-Muzzammil",ar:"Ø§Ù„Ù…Ø²Ù…Ù„",a:20,s:5476},
    {n:74,name:"Al-Muddaththir",ar:"Ø§Ù„Ù…Ø¯Ø«Ø±",a:56,s:5496},
    {n:75,name:"Al-Qiyamah",ar:"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©",a:40,s:5552},
    {n:76,name:"Al-Insan",ar:"Ø§Ù„Ø¥Ù†Ø³Ø§Ù†",a:31,s:5592},
    {n:77,name:"Al-Mursalat",ar:"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª",a:50,s:5623},
    {n:78,name:"An-Naba",ar:"Ø§Ù„Ù†Ø¨Ø£",a:40,s:5673},
    {n:79,name:"An-Nazi'at",ar:"Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª",a:46,s:5713},
    {n:80,name:"Abasa",ar:"Ø¹Ø¨Ø³",a:42,s:5759},
    {n:81,name:"At-Takwir",ar:"Ø§Ù„ØªÙƒÙˆÙŠØ±",a:29,s:5801},
    {n:82,name:"Al-Infitar",ar:"Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±",a:19,s:5830},
    {n:83,name:"Al-Mutaffifin",ar:"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†",a:36,s:5849},
    {n:84,name:"Al-Inshiqaq",ar:"Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚",a:25,s:5885},
    {n:85,name:"Al-Buruj",ar:"Ø§Ù„Ø¨Ø±ÙˆØ¬",a:22,s:5910},
    {n:86,name:"At-Tariq",ar:"Ø§Ù„Ø·Ø§Ø±Ù‚",a:17,s:5932},
    {n:87,name:"Al-A'la",ar:"Ø§Ù„Ø£Ø¹Ù„Ù‰",a:19,s:5949},
    {n:88,name:"Al-Ghashiyah",ar:"Ø§Ù„ØºØ§Ø´ÙŠØ©",a:26,s:5968},
    {n:89,name:"Al-Fajr",ar:"Ø§Ù„ÙØ¬Ø±",a:30,s:5994},
    {n:90,name:"Al-Balad",ar:"Ø§Ù„Ø¨Ù„Ø¯",a:20,s:6024},
    {n:91,name:"Ash-Shams",ar:"Ø§Ù„Ø´Ù…Ø³",a:15,s:6044},
    {n:92,name:"Al-Layl",ar:"Ø§Ù„Ù„ÙŠÙ„",a:21,s:6059},
    {n:93,name:"Ad-Duhaa",ar:"Ø§Ù„Ø¶Ø­Ù‰",a:11,s:6080},
    {n:94,name:"Ash-Sharh",ar:"Ø§Ù„Ø´Ø±Ø­",a:8,s:6091},
    {n:95,name:"At-Tin",ar:"Ø§Ù„ØªÙŠÙ†",a:8,s:6099},
    {n:96,name:"Al-Alaq",ar:"Ø§Ù„Ø¹Ù„Ù‚",a:19,s:6107},
    {n:97,name:"Al-Qadr",ar:"Ø§Ù„Ù‚Ø¯Ø±",a:5,s:6126},
    {n:98,name:"Al-Bayyinah",ar:"Ø§Ù„Ø¨ÙŠÙ†Ø©",a:8,s:6131},
    {n:99,name:"Az-Zalzalah",ar:"Ø§Ù„Ø²Ù„Ø²Ù„Ø©",a:8,s:6139},
    {n:100,name:"Al-Adiyat",ar:"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª",a:11,s:6147},
    {n:101,name:"Al-Qari'ah",ar:"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©",a:11,s:6158},
    {n:102,name:"At-Takathur",ar:"Ø§Ù„ØªÙƒØ§Ø«Ø±",a:8,s:6169},
    {n:103,name:"Al-Asr",ar:"Ø§Ù„Ø¹ØµØ±",a:3,s:6177},
    {n:104,name:"Al-Humazah",ar:"Ø§Ù„Ù‡Ù…Ø²Ø©",a:9,s:6180},
    {n:105,name:"Al-Fil",ar:"Ø§Ù„ÙÙŠÙ„",a:5,s:6189},
    {n:106,name:"Quraysh",ar:"Ù‚Ø±ÙŠØ´",a:4,s:6194},
    {n:107,name:"Al-Ma'un",ar:"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†",a:7,s:6198},
    {n:108,name:"Al-Kawthar",ar:"Ø§Ù„ÙƒÙˆØ«Ø±",a:3,s:6205},
    {n:109,name:"Al-Kafirun",ar:"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†",a:6,s:6208},
    {n:110,name:"An-Nasr",ar:"Ø§Ù„Ù†ØµØ±",a:3,s:6214},
    {n:111,name:"Al-Masad",ar:"Ø§Ù„Ù…Ø³Ø¯",a:5,s:6217},
    {n:112,name:"Al-Ikhlas",ar:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ",a:4,s:6222},
    {n:113,name:"Al-Falaq",ar:"Ø§Ù„ÙÙ„Ù‚",a:5,s:6226},
    {n:114,name:"An-Nas",ar:"Ø§Ù„Ù†Ø§Ø³",a:6,s:6231}
];

// Para (Juz) to Surah mapping
const PARAS = {
    1: [1,2], 2: [2], 3: [2,3], 4: [3,4], 5: [4], 6: [4,5], 7: [5,6], 8: [6,7], 9: [7,8], 10: [8,9],
    11: [9,10,11], 12: [11,12], 13: [12,13,14], 14: [15,16], 15: [17,18], 16: [18,19,20], 17: [21,22], 18: [23,24,25],
    19: [25,26,27], 20: [27,28,29], 21: [29,30,31,32,33], 22: [33,34,35,36], 23: [36,37,38,39], 24: [39,40,41],
    25: [41,42,43,44,45], 26: [46,47,48,49,50,51], 27: [51,52,53,54,55,56,57], 28: [58,59,60,61,62,63,64,65,66],
    29: [67,68,69,70,71,72,73,74,75,76,77], 30: [78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114]
};

const QARIS = [
    {id:"alafasy", name:"Mishary Alafasy", emoji:"ğŸ™ï¸"},
    {id:"husary", name:"Mahmoud Al-Husary", emoji:"ğŸ“¿"},
    {id:"minshawi", name:"Mohamed Al-Minshawi", emoji:"ğŸŒ™"}
];

const LANG = {
    uz: {
        heroTitle: "Xush kelibsiz!",
        heroDesc: "Qur'on hifzini mustahkamlang va bilimingizni sinang",
        highScore: "Eng yuqori natija",
        btnTextTest: "Matnli test",
        btnAudioTest: "Audio test",
        btnTips: "Maslahatlar",
        textTestTitle: "Matnli test",
        audioTestTitle: "Audio test",
        testType: "Test turi",
        typeContinue: "Davomini toping",
        typeContinueDesc: "Keyingi oyat",
        typeSurah: "Surani toping",
        typeSurahDesc: "Qaysi sura?",
        audioSurah: "Surani toping",
        audioSurahDesc: "Eshiting va toping",
        audioContinue: "Davomi",
        audioContinueDesc: "Keyingisi nima?",
        difficulty: "Qiyinchilik",
        easy: "Oson",
        medium: "O'rta",
        hard: "Qiyin",
        selectPara: "Para tanlang",
        allSurahs: "Barcha suralardan",
        orSelectPara: "yoki para tanlang",
        selectQari: "Qori tanlang",
        startTest: "Testni boshlash",
        back: "Ortga",
        exit: "Chiqish",
        next: "Keyingi",
        wisdom: "Hikmat",
        resultTitle: "Natija",
        correct: "To'g'ri",
        wrong: "Xato",
        retry: "Qayta urinish",
        home: "Bosh sahifa",
        tipsTitle: "Maslahatlar",
        loading: "Yuklanmoqda...",
        tapToPlay: "Tinglash uchun bosing",
        playing: "Ijro etilmoqda...",
        questionContinue: "Ushbu oyatdan keyin qaysi oyat keladi?",
        questionSurah: "Bu oyat qaysi suradan?",
        questionAudioSurah: "Bu qaysi sura?",
        questionAudioCont: "Eshitgan oyatdan keyin nima keladi?",
        modeContinue: "DAVOMI",
        modeSurah: "SURANI TOP",
        modeAudioSurah: "AUDIO SURA",
        modeAudioCont: "AUDIO DAVOM",
        perfect: "ğŸŒŸ MashaAlloh! Mukammal natija!",
        great: "âœ¨ Barakalloh! Juda yaxshi!",
        good: "ğŸ‘ Yaxshi! Davom eting!",
        fail: "ğŸ’ª G'ayrat qiling! Sabr bilan!",
        tips: [
            {icon:"ğŸ¯", title:"Ixlos", desc:"Qur'onni faqat Alloh uchun o'rganing"},
            {icon:"ğŸ“", title:"Yozish", desc:"O'rgangan oyatlarni yozib boring"},
            {icon:"ğŸ”„", title:"Takror", desc:"Har kuni takrorlang"},
            {icon:"ğŸ§", title:"Tinglash", desc:"Qoridan ko'p tinglang"},
            {icon:"ğŸ¤²", title:"Duo", desc:"Allohdan yordam so'rang"}
        ],
        wisdoms: [
            {t:"Qur'on ahli - Allohning yaqinlari", s:"Hadis"},
            {t:"Eng yaxshilaringiz Qur'on o'rganuvchilar", s:"Buxoriy"},
            {t:"Qur'onni takrorlang, u tez ketadi", s:"Hadis"}
        ]
    },
    ar: {
        heroTitle: "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!",
        heroDesc: "Ø¹Ø²Ø² Ø­ÙØ¸Ùƒ ÙˆØ§Ø®ØªØ¨Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ",
        highScore: "Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©",
        btnTextTest: "Ø§Ø®ØªØ¨Ø§Ø± Ù†ØµÙŠ",
        btnAudioTest: "Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØªÙŠ",
        btnTips: "Ù†ØµØ§Ø¦Ø­",
        textTestTitle: "Ø§Ø®ØªØ¨Ø§Ø± Ù†ØµÙŠ",
        audioTestTitle: "Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØªÙŠ",
        testType: "Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
        typeContinue: "Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¢ÙŠØ©",
        typeContinueDesc: "Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©",
        typeSurah: "Ø­Ø¯Ø¯ Ø§Ù„Ø³ÙˆØ±Ø©",
        typeSurahDesc: "Ø£ÙŠ Ø³ÙˆØ±Ø©ØŸ",
        audioSurah: "Ø­Ø¯Ø¯ Ø§Ù„Ø³ÙˆØ±Ø©",
        audioSurahDesc: "Ø§Ø³ØªÙ…Ø¹ ÙˆØ­Ø¯Ø¯",
        audioContinue: "Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„",
        audioContinueDesc: "Ù…Ø§ Ø§Ù„ØªØ§Ù„ÙŠØŸ",
        difficulty: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰",
        easy: "Ø³Ù‡Ù„",
        medium: "Ù…ØªÙˆØ³Ø·",
        hard: "ØµØ¹Ø¨",
        selectPara: "Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø²Ø¡",
        allSurahs: "ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±",
        orSelectPara: "Ø£Ùˆ Ø§Ø®ØªØ± Ø¬Ø²Ø¡Ø§Ù‹",
        selectQari: "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦",
        startTest: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±",
        back: "Ø±Ø¬ÙˆØ¹",
        exit: "Ø®Ø±ÙˆØ¬",
        next: "Ø§Ù„ØªØ§Ù„ÙŠ",
        wisdom: "Ø­ÙƒÙ…Ø©",
        resultTitle: "Ø§Ù„Ù†ØªÙŠØ¬Ø©",
        correct: "ØµØ­ÙŠØ­",
        wrong: "Ø®Ø·Ø£",
        retry: "Ø¥Ø¹Ø§Ø¯Ø©",
        home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        tipsTitle: "Ù†ØµØ§Ø¦Ø­",
        loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",
        tapToPlay: "Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹",
        playing: "ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„...",
        questionContinue: "Ù…Ø§ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ",
        questionSurah: "Ù…Ù† Ø£ÙŠ Ø³ÙˆØ±Ø©ØŸ",
        questionAudioSurah: "Ù…Ø§ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙˆØ±Ø©ØŸ",
        questionAudioCont: "Ù…Ø§ Ø¨Ø¹Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ©ØŸ",
        modeContinue: "Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„",
        modeSurah: "Ø§Ù„Ø³ÙˆØ±Ø©",
        modeAudioSurah: "ØµÙˆØªÙŠ",
        modeAudioCont: "ØµÙˆØªÙŠ",
        perfect: "ğŸŒŸ Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ù…Ù…ØªØ§Ø²!",
        great: "âœ¨ Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒ!",
        good: "ğŸ‘ Ø¬ÙŠØ¯! Ø§Ø³ØªÙ…Ø±!",
        fail: "ğŸ’ª Ø§Ø¬ØªÙ‡Ø¯ Ø£ÙƒØ«Ø±!",
        tips: [
            {icon:"ğŸ¯", title:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", desc:"Ø§Ø­ÙØ¸ Ù„Ù„Ù‡ ÙÙ‚Ø·"},
            {icon:"ğŸ“", title:"Ø§Ù„ÙƒØªØ§Ø¨Ø©", desc:"Ø§ÙƒØªØ¨ Ù…Ø§ ØªØ­ÙØ¸"},
            {icon:"ğŸ”„", title:"Ø§Ù„ØªÙƒØ±Ø§Ø±", desc:"Ø±Ø§Ø¬Ø¹ ÙŠÙˆÙ…ÙŠØ§Ù‹"},
            {icon:"ğŸ§", title:"Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹", desc:"Ø§Ø³ØªÙ…Ø¹ ÙƒØ«ÙŠØ±Ø§Ù‹"},
            {icon:"ğŸ¤²", title:"Ø§Ù„Ø¯Ø¹Ø§Ø¡", desc:"Ø§Ø¯Ø¹ Ø§Ù„Ù„Ù‡"}
        ],
        wisdoms: [
            {t:"Ø£Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ù‡Ù„ Ø§Ù„Ù„Ù‡", s:"Ø­Ø¯ÙŠØ«"},
            {t:"Ø®ÙŠØ±ÙƒÙ… Ù…Ù† ØªØ¹Ù„Ù… Ø§Ù„Ù‚Ø±Ø¢Ù†", s:"Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"},
            {t:"ØªØ¹Ø§Ù‡Ø¯ÙˆØ§ Ø§Ù„Ù‚Ø±Ø¢Ù†", s:"Ø­Ø¯ÙŠØ«"}
        ]
    },
    ru: {
        heroTitle: "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ!",
        heroDesc: "Ğ£ĞºÑ€ĞµĞ¿Ğ¸Ñ‚Ğµ Ñ…Ğ¸Ñ„Ğ· Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ",
        highScore: "Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚",
        btnTextTest: "Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚",
        btnAudioTest: "ĞÑƒĞ´Ğ¸Ğ¾ Ñ‚ĞµÑÑ‚",
        btnTips: "Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹",
        textTestTitle: "Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚",
        audioTestTitle: "ĞÑƒĞ´Ğ¸Ğ¾ Ñ‚ĞµÑÑ‚",
        testType: "Ğ¢Ğ¸Ğ¿ Ñ‚ĞµÑÑ‚Ğ°",
        typeContinue: "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ",
        typeContinueDesc: "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ°ÑÑ‚",
        typeSurah: "ĞĞ°Ğ¹Ñ‚Ğ¸ ÑÑƒÑ€Ñƒ",
        typeSurahDesc: "ĞšĞ°ĞºĞ°Ñ ÑÑƒÑ€Ğ°?",
        audioSurah: "ĞĞ°Ğ¹Ñ‚Ğ¸ ÑÑƒÑ€Ñƒ",
        audioSurahDesc: "Ğ¡Ğ»ÑƒÑˆĞ°Ğ¹Ñ‚Ğµ",
        audioContinue: "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ",
        audioContinueDesc: "Ğ§Ñ‚Ğ¾ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?",
        difficulty: "Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ",
        easy: "Ğ›ĞµĞ³ĞºĞ¾",
        medium: "Ğ¡Ñ€ĞµĞ´Ğ½Ğµ",
        hard: "Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾",
        selectPara: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ¶ÑƒĞ·",
        allSurahs: "Ğ’ÑĞµ ÑÑƒÑ€Ñ‹",
        orSelectPara: "Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ¶ÑƒĞ·",
        selectQari: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‡Ñ‚ĞµÑ†Ğ°",
        startTest: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚",
        back: "ĞĞ°Ğ·Ğ°Ğ´",
        exit: "Ğ’Ñ‹Ñ…Ğ¾Ğ´",
        next: "Ğ”Ğ°Ğ»ĞµĞµ",
        wisdom: "ĞœÑƒĞ´Ñ€Ğ¾ÑÑ‚ÑŒ",
        resultTitle: "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚",
        correct: "Ğ’ĞµÑ€Ğ½Ğ¾",
        wrong: "ĞÑˆĞ¸Ğ±ĞºĞ¸",
        retry: "ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ",
        home: "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ",
        tipsTitle: "Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹",
        loading: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...",
        tapToPlay: "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ",
        playing: "Ğ˜Ğ³Ñ€Ğ°ĞµÑ‚...",
        questionContinue: "ĞšĞ°ĞºĞ¾Ğ¹ Ğ°ÑÑ‚ ÑĞ»ĞµĞ´ÑƒĞµÑ‚?",
        questionSurah: "Ğ˜Ğ· ĞºĞ°ĞºĞ¾Ğ¹ ÑÑƒÑ€Ñ‹?",
        questionAudioSurah: "ĞšĞ°ĞºĞ°Ñ ÑÑ‚Ğ¾ ÑÑƒÑ€Ğ°?",
        questionAudioCont: "Ğ§Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ?",
        modeContinue: "ĞŸĞ ĞĞ”ĞĞ›Ğ–.",
        modeSurah: "Ğ¡Ğ£Ğ Ğ",
        modeAudioSurah: "ĞĞ£Ğ”Ğ˜Ğ",
        modeAudioCont: "ĞĞ£Ğ”Ğ˜Ğ",
        perfect: "ğŸŒŸ ĞœĞ°ÑˆĞ°ĞĞ»Ğ»Ğ°Ñ…! Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾!",
        great: "âœ¨ Ğ‘Ğ°Ñ€Ğ°ĞºĞ°Ğ›Ğ»Ğ°Ñ…!",
        good: "ğŸ‘ Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾!",
        fail: "ğŸ’ª Ğ¡Ñ‚Ğ°Ñ€Ğ°Ğ¹Ñ‚ĞµÑÑŒ!",
        tips: [
            {icon:"ğŸ¯", title:"Ğ˜Ñ…Ğ»Ğ°Ñ", desc:"Ğ£Ñ‡Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ´Ğ¸ ĞĞ»Ğ»Ğ°Ñ…Ğ°"},
            {icon:"ğŸ“", title:"Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ", desc:"Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ"},
            {icon:"ğŸ”„", title:"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€", desc:"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹Ñ‚Ğµ"},
            {icon:"ğŸ§", title:"Ğ¡Ğ»ÑƒÑˆĞ°Ğ½Ğ¸Ğµ", desc:"Ğ¡Ğ»ÑƒÑˆĞ°Ğ¹Ñ‚Ğµ"},
            {icon:"ğŸ¤²", title:"Ğ”ÑƒĞ°", desc:"ĞŸÑ€Ğ¾ÑĞ¸Ñ‚Ğµ ĞĞ»Ğ»Ğ°Ñ…Ğ°"}
        ],
        wisdoms: [
            {t:"Ğ›ÑĞ´Ğ¸ ĞšĞ¾Ñ€Ğ°Ğ½Ğ° - Ğ»ÑĞ´Ğ¸ ĞĞ»Ğ»Ğ°Ñ…Ğ°", s:"Ğ¥Ğ°Ğ´Ğ¸Ñ"},
            {t:"Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ - ÑƒÑ‡Ğ°Ñ‰Ğ¸Ğµ ĞšĞ¾Ñ€Ğ°Ğ½", s:"Ğ‘ÑƒÑ…Ğ°Ñ€Ğ¸"},
            {t:"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹Ñ‚Ğµ ĞšĞ¾Ñ€Ğ°Ğ½", s:"Ğ¥Ğ°Ğ´Ğ¸Ñ"}
        ]
    },
    en: {
        heroTitle: "Welcome!",
        heroDesc: "Strengthen your Quran memorization",
        highScore: "High Score",
        btnTextTest: "Text Test",
        btnAudioTest: "Audio Test",
        btnTips: "Tips",
        textTestTitle: "Text Test",
        audioTestTitle: "Audio Test",
        testType: "Test Type",
        typeContinue: "Continue",
        typeContinueDesc: "Next ayah",
        typeSurah: "Find Surah",
        typeSurahDesc: "Which surah?",
        audioSurah: "Find Surah",
        audioSurahDesc: "Listen & find",
        audioContinue: "Continue",
        audioContinueDesc: "What's next?",
        difficulty: "Difficulty",
        easy: "Easy",
        medium: "Medium",
        hard: "Hard",
        selectPara: "Select Juz",
        allSurahs: "All Surahs",
        orSelectPara: "or select juz",
        selectQari: "Select Reciter",
        startTest: "Start Test",
        back: "Back",
        exit: "Exit",
        next: "Next",
        wisdom: "Wisdom",
        resultTitle: "Result",
        correct: "Correct",
        wrong: "Wrong",
        retry: "Retry",
        home: "Home",
        tipsTitle: "Tips",
        loading: "Loading...",
        tapToPlay: "Tap to play",
        playing: "Playing...",
        questionContinue: "Which ayah comes next?",
        questionSurah: "Which surah is this?",
        questionAudioSurah: "Which surah?",
        questionAudioCont: "What follows?",
        modeContinue: "CONTINUE",
        modeSurah: "SURAH",
        modeAudioSurah: "AUDIO",
        modeAudioCont: "AUDIO",
        perfect: "ğŸŒŸ MashaAllah! Perfect!",
        great: "âœ¨ BarakAllah! Great!",
        good: "ğŸ‘ Good! Keep going!",
        fail: "ğŸ’ª Keep trying!",
        tips: [
            {icon:"ğŸ¯", title:"Ikhlas", desc:"Learn for Allah only"},
            {icon:"ğŸ“", title:"Writing", desc:"Write what you learn"},
            {icon:"ğŸ”„", title:"Review", desc:"Review daily"},
            {icon:"ğŸ§", title:"Listen", desc:"Listen often"},
            {icon:"ğŸ¤²", title:"Dua", desc:"Ask Allah"}
        ],
        wisdoms: [
            {t:"People of Quran are Allah's people", s:"Hadith"},
            {t:"Best are those who learn Quran", s:"Bukhari"},
            {t:"Review the Quran regularly", s:"Hadith"}
        ]
    }
};

// ========== APP ==========
const App = {
    lang: 'uz',
    theme: 'light',
    testType: 'continue',
    audioType: 'surah',
    diff: 'medium',
    qari: QARIS[0],
    selectedPara: null,
    questions: [],
    current: 0,
    score: 0,
    total: 10,
    answered: false,
    audio: null,
    mode: null,
    cache: {},

    init() {
        this.lang = localStorage.getItem('qiq_lang') || 'uz';
        this.theme = localStorage.getItem('qiq_theme') || 'light';
        const hs = localStorage.getItem('qiq_best') || '0';
        
        document.body.dataset.theme = this.theme;
        document.getElementById('langSelect').value = this.lang;
        document.getElementById('themeBtn').textContent = this.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        document.getElementById('bestScore').textContent = hs + '%';
        
        if (this.lang === 'ar') document.body.style.direction = 'rtl';
        
        this.updateTexts();
        this.renderParas();
        this.renderQaris();
        this.renderTips();
    },

    t(key) { return LANG[this.lang][key] || key; },

    updateTexts() {
        document.querySelectorAll('[data-t]').forEach(el => {
            const key = el.dataset.t;
            if (LANG[this.lang][key]) el.textContent = LANG[this.lang][key];
        });
    },

    changeLang(lang) {
        this.lang = lang;
        localStorage.setItem('qiq_lang', lang);
        document.body.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
        this.updateTexts();
        this.renderTips();
    },

    toggleTheme() {
        this.theme = this.theme === 'light' ? 'dark' : 'light';
        document.body.dataset.theme = this.theme;
        document.getElementById('themeBtn').textContent = this.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        localStorage.setItem('qiq_theme', this.theme);
    },

    goTo(page) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const pages = {home:'pageHome', textSetup:'pageTextSetup', audioSetup:'pageAudioSetup', quiz:'pageQuiz', result:'pageResult', tips:'pageTips'};
        document.getElementById(pages[page]).classList.add('active');
        window.scrollTo({top:0, behavior:'smooth'});
    },

    setTestType(type) {
        this.testType = type;
        document.querySelectorAll('[data-ttype]').forEach(c => c.classList.toggle('active', c.dataset.ttype === type));
    },

    setAudioType(type) {
        this.audioType = type;
        document.querySelectorAll('[data-atype]').forEach(c => c.classList.toggle('active', c.dataset.atype === type));
    },

    setDiff(d) {
        this.diff = d;
        document.querySelectorAll('[data-diff]').forEach(p => p.classList.toggle('active', p.dataset.diff === d));
    },

    selectQari(id) {
        this.qari = QARIS.find(q => q.id === id);
        document.querySelectorAll('.qari-card').forEach(c => c.classList.toggle('active', c.dataset.qid === id));
    },

    renderParas() {
        const grid = document.getElementById('paraGrid');
        grid.innerHTML = '';
        for (let i = 1; i <= 30; i++) {
            const btn = document.createElement('button');
            btn.className = 'para-item';
            btn.textContent = i;
            btn.onclick = () => {
                document.querySelectorAll('.para-item').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                this.selectedPara = i;
                setTimeout(() => this.beginTest('text'), 300);
            };
            grid.appendChild(btn);
        }
    },

    renderQaris() {
        const grid = document.getElementById('qariGrid');
        grid.innerHTML = '';
        QARIS.forEach((q, i) => {
            const card = document.createElement('div');
            card.className = 'qari-card' + (i === 0 ? ' active' : '');
            card.dataset.qid = q.id;
            card.innerHTML = `<div class="qari-avatar">${q.emoji}</div><div class="qari-name">${q.name}</div>`;
            card.onclick = () => this.selectQari(q.id);
            grid.appendChild(card);
        });
    },

    renderTips() {
        const list = document.getElementById('adviceList');
        const tips = LANG[this.lang].tips;
        list.innerHTML = tips.map(t => `
            <li class="advice-item">
                <div class="advice-icon">${t.icon}</div>
                <div class="advice-content">
                    <div class="advice-title">${t.title}</div>
                    <div class="advice-desc">${t.desc}</div>
                </div>
            </li>
        `).join('');
    },

    shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    },

    async fetchAyah(surah, ayah) {
        const key = `${surah}:${ayah}`;
        if (this.cache[key]) return this.cache[key];
        try {
            const res = await fetch(`https://api.alquran.cloud/v1/ayah/${surah}:${ayah}`);
            const data = await res.json();
            if (data.code === 200) {
                this.cache[key] = data.data;
                return data.data;
            }
        } catch(e) { console.error(e); }
        return null;
    },

    getAudioUrl(num) {
        const base = 'https://cdn.islamic.network/quran/audio/128/ar.alafasy/';
        return base + num + '.mp3';
    },

    getSurahsForTest() {
        if (this.selectedPara && PARAS[this.selectedPara]) {
            return PARAS[this.selectedPara].map(n => SURAHS.find(s => s.n === n)).filter(Boolean);
        }
        return SURAHS;
    },

    async generateQuestions(type) {
        const questions = [];
        const pool = this.getSurahsForTest();
        const count = this.diff === 'easy' ? 5 : this.diff === 'hard' ? 15 : 10;
        const selected = this.shuffle(pool).slice(0, count + 5);

        for (const surah of selected) {
            if (questions.length >= count) break;
            
            const maxA = type === 'continue' ? surah.a - 1 : surah.a;
            if (maxA < 1) continue;
            
            const ayahNum = Math.floor(Math.random() * maxA) + 1;
            const globalNum = surah.s + ayahNum - 1;

            try {
                const current = await this.fetchAyah(surah.n, ayahNum);
                if (!current) continue;

                if (type === 'continue') {
                    const next = await this.fetchAyah(surah.n, ayahNum + 1);
                    if (!next) continue;

                    const wrongs = [];
                    const others = this.shuffle(SURAHS.filter(s => s.n !== surah.n)).slice(0, 5);
                    for (const o of others) {
                        if (wrongs.length >= 3) break;
                        const wA = Math.floor(Math.random() * o.a) + 1;
                        const w = await this.fetchAyah(o.n, wA);
                        if (w) wrongs.push(w.text);
                    }

                    if (wrongs.length >= 3) {
                        const opts = this.shuffle([next.text, ...wrongs.slice(0,3)]);
                        questions.push({
                            type: 'continue',
                            surah, ayahNum, globalNum,
                            text: current.text,
                            answer: next.text,
                            options: opts,
                            correctIdx: opts.indexOf(next.text)
                        });
                    }
                } else {
                    const others = this.shuffle(SURAHS.filter(s => s.n !== surah.n)).slice(0, 3);
                    const opts = this.shuffle([surah, ...others]);
                    questions.push({
                        type: 'surah',
                        surah, ayahNum, globalNum,
                        text: current.text,
                        answer: surah.name,
                        options: opts,
                        correctIdx: opts.findIndex(o => o.n === surah.n)
                    });
                }
            } catch(e) { console.error(e); }
        }
        return questions;
    },

    showLoader(show) {
        document.getElementById('loader').classList.toggle('show', show);
        document.getElementById('loaderText').textContent = this.t('loading');
    },

    async beginTest(mode) {
        this.showLoader(true);
        this.current = 0;
        this.score = 0;
        this.answered = false;

        const type = mode === 'text' ? this.testType : this.audioType;
        this.mode = mode + '_' + type;
        this.questions = await this.generateQuestions(type);

        this.showLoader(false);

        if (!this.questions.length) {
            alert('Xatolik! Qaytadan urinib ko\'ring.');
            return;
        }

        this.total = this.questions.length;
        this.goTo('quiz');
        this.showQ();
    },

    showQ() {
        const q = this.questions[this.current];
        this.answered = false;

        document.getElementById('progressFill').style.width = (this.current / this.total * 100) + '%';
        document.getElementById('quizCount').textContent = `${this.current + 1} / ${this.total}`;

        let badge = this.mode.includes('continue') ? 
            (this.mode.includes('audio') ? this.t('modeAudioCont') : this.t('modeContinue')) :
            (this.mode.includes('audio') ? this.t('modeAudioSurah') : this.t('modeSurah'));
        document.getElementById('quizBadge').textContent = badge;

        let qText = this.mode.includes('continue') ?
            (this.mode.includes('audio') ? this.t('questionAudioCont') : this.t('questionContinue')) :
            (this.mode.includes('audio') ? this.t('questionAudioSurah') : this.t('questionSurah'));
        document.getElementById('questionText').textContent = qText;

        const ayahEl = document.getElementById('ayahDisplay');
        const audioEl = document.getElementById('audioPlayer');

        if (this.mode.includes('text')) {
            ayahEl.classList.remove('hidden');
            audioEl.classList.add('hidden');
            document.getElementById('ayahArabic').textContent = q.text;
            document.getElementById('ayahInfo').textContent = `${q.surah.name} (${q.surah.ar}) - ${q.ayahNum}`;
        } else {
            ayahEl.classList.add('hidden');
            audioEl.classList.remove('hidden');
            this.setupAudio(q.globalNum);
        }

        const optList = document.getElementById('optionsList');
        optList.innerHTML = '';
        const letters = ['A', 'B', 'C', 'D'];

        q.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'option-item';
            
            if (q.type === 'continue') {
                div.classList.add('arabic');
                div.innerHTML = `<span class="option-letter">${letters[i]}</span><span class="option-content">${opt}</span>`;
            } else {
                const name = this.lang === 'ar' ? opt.ar : opt.name;
                div.innerHTML = `<span class="option-letter">${letters[i]}</span><span class="option-content">${name}</span>`;
            }

            div.onclick = () => this.answer(i);
            optList.appendChild(div);
        });

        document.getElementById('wisdomBox').classList.remove('show');
        document.getElementById('nextBtn').classList.remove('show');
    },

    setupAudio(num) {
        if (this.audio) { this.audio.pause(); this.audio = null; }
        
        const btn = document.getElementById('playButton');
        const txt = document.getElementById('audioText');
        
        btn.textContent = 'â–¶ï¸';
        btn.classList.remove('playing');
        txt.textContent = this.t('tapToPlay');

        this.audio = new Audio(this.getAudioUrl(num));
        this.audio.onplay = () => { btn.textContent = 'â¸ï¸'; btn.classList.add('playing'); txt.textContent = this.t('playing'); };
        this.audio.onpause = () => { btn.textContent = 'â–¶ï¸'; btn.classList.remove('playing'); };
        this.audio.onended = () => { btn.textContent = 'â–¶ï¸'; btn.classList.remove('playing'); txt.textContent = this.t('tapToPlay'); };
        this.audio.onerror = () => { txt.textContent = 'âš ï¸ Audio xato'; };
    },

    togglePlay() {
        if (!this.audio) return;
        if (this.audio.paused) this.audio.play().catch(e => console.error(e));
        else this.audio.pause();
    },

    answer(idx) {
        if (this.answered) return;
        this.answered = true;

        const q = this.questions[this.current];
        const opts = document.querySelectorAll('.option-item');

        opts.forEach(o => o.classList.add('disabled'));

        if (idx === q.correctIdx) {
            opts[idx].classList.add('correct');
            this.score++;
        } else {
            opts[idx].classList.add('wrong');
            opts[q.correctIdx].classList.add('correct');
        }

        const wisdoms = LANG[this.lang].wisdoms;
        const w = wisdoms[Math.floor(Math.random() * wisdoms.length)];
        document.getElementById('wisdomText').textContent = w.t;
        document.getElementById('wisdomSource').textContent = 'â€” ' + w.s;
        document.getElementById('wisdomBox').classList.add('show');

        document.getElementById('nextBtn').classList.add('show');
    },

    nextQ() {
        this.current++;
        if (this.current >= this.total) this.showResult();
        else this.showQ();
    },

    showResult() {
        if (this.audio) { this.audio.pause(); this.audio = null; }

        const pct = Math.round(this.score / this.total * 100);
        const best = parseInt(localStorage.getItem('qiq_best') || '0');
        if (pct > best) {
            localStorage.setItem('qiq_best', pct);
            document.getElementById('bestScore').textContent = pct + '%';
        }

        this.goTo('result');

        document.getElementById('resultPercent').textContent = pct + '%';
        document.getElementById('correctCount').textContent = this.score;
        document.getElementById('wrongCount').textContent = this.total - this.score;

        const ring = document.getElementById('resultRing');
        ring.classList.remove('excellent', 'good', 'poor');

        let msg = '';
        if (pct >= 90) { ring.classList.add('excellent'); msg = this.t('perfect'); }
        else if (pct >= 60) { ring.classList.add('good'); msg = this.t('great'); }
        else if (pct >= 40) { ring.classList.add('good'); msg = this.t('good'); }
        else { ring.classList.add('poor'); msg = this.t('fail'); }

        document.getElementById('resultMessage').textContent = msg;
    },

    quitQuiz() {
        if (this.audio) { this.audio.pause(); this.audio = null; }
        this.goTo('home');
    },

    retryTest() {
        this.beginTest(this.mode.includes('text') ? 'text' : 'audio');
    }
};

document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
